/***(C)2011***************************************************************
*
* Copyright (C) 2011 MIPS Tech, LLC
* 
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions are met:
* 
* 1. Redistributions of source code must retain the above copyright notice,
* this list of conditions and the following disclaimer.
* 2. Redistributions in binary form must reproduce the above copyright notice,
* this list of conditions and the following disclaimer in the documentation
* and/or other materials provided with the distribution.
* 3. Neither the name of the copyright holder nor the names of its
* contributors may be used to endorse or promote products derived from this
* software without specific prior written permission.
* 
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
* AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
* ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
* LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
* CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
* SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
* INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
* CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
* ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
* POSSIBILITY OF SUCH DAMAGE.
*
****(C)2011**************************************************************/

/*************************************************************************
 *
 *   Description:	CPIO test code
 *
 *************************************************************************/

/*
 * This test checks that the CPIO module correctly writes and reads from
 * memory.
 */

#include <assert.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "MEOS.h"

#define TSTACKSIZE 2000		/* MEOS timer task stack size */
#define STACKSIZE 1000
#define PRIORITIES 5
#define MAX_PRIORITY (PRIORITIES -1)

static KRN_TASK_T *bgtask;
static uint32_t timestack[TSTACKSIZE];
uint32_t istack[STACKSIZE];

static KRN_SCHEDULE_T sched;
static KRN_TASKQ_T schedQueues[PRIORITIES];

int32_t passed = -1;		/* Zero success, non-zero fail */

unsigned char cpio_filedata0[] =
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test,\n"
    "this is a test, this is a test, this is a test, this is a test\n";

unsigned char cpio_filedata1[] =
    "this is test2, this is test2, this is test2,\n"
    "this is test2, this is test2, this is test2,\n"
    "this is test2, this is test2, this is test2,\n"
    "this is test2, this is test2, this is test2,\n"
    "this is test2, this is test2, this is test2\n";

unsigned char cpio_file[] = {
	0xc7, 0x71, 0x01, 0x08, 0x3f, 0x2d, 0xb4, 0x81, 0xe8, 0x03, 0xe8, 0x03,
	0x01,
	0x00, 0x00, 0x00, 0x6b, 0x57, 0x88, 0xf8, 0x09, 0x00, 0x00, 0x00, 0xff,
	0x06,
	0x74, 0x65, 0x73, 0x74, 0x2e, 0x74, 0x78, 0x74, 0x00, 0x00, 0x74, 0x68,
	0x69,
	0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c,
	0x20,
	0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65,
	0x73,
	0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61,
	0x20,
	0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69,
	0x73,
	0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69,
	0x73,
	0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20,
	0x74,
	0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73,
	0x74,
	0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20,
	0x74,
	0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73,
	0x20,
	0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73,
	0x20,
	0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74,
	0x68,
	0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74,
	0x2c,
	0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74,
	0x65,
	0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20,
	0x61,
	0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20,
	0x69,
	0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68,
	0x69,
	0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c,
	0x20,
	0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65,
	0x73,
	0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61,
	0x20,
	0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69,
	0x73,
	0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69,
	0x73,
	0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20,
	0x74,
	0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73,
	0x74,
	0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20,
	0x74,
	0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73,
	0x20,
	0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73,
	0x20,
	0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74,
	0x68,
	0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74,
	0x2c,
	0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74,
	0x65,
	0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20,
	0x61,
	0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20,
	0x69,
	0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68,
	0x69,
	0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c,
	0x20,
	0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65,
	0x73,
	0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61,
	0x20,
	0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69,
	0x73,
	0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69,
	0x73,
	0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20,
	0x74,
	0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73,
	0x74,
	0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20,
	0x74,
	0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73,
	0x20,
	0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73,
	0x20,
	0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74,
	0x68,
	0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74,
	0x2c,
	0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74,
	0x65,
	0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20,
	0x61,
	0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20,
	0x69,
	0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68,
	0x69,
	0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c,
	0x0a,
	0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65,
	0x73,
	0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61,
	0x20,
	0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69,
	0x73,
	0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69,
	0x73,
	0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a,
	0x74,
	0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73,
	0x74,
	0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20,
	0x74,
	0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73,
	0x20,
	0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73,
	0x20,
	0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74,
	0x68,
	0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74,
	0x2c,
	0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74,
	0x65,
	0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20,
	0x61,
	0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20,
	0x69,
	0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68,
	0x69,
	0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c,
	0x20,
	0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65,
	0x73,
	0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61,
	0x20,
	0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69,
	0x73,
	0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69,
	0x73,
	0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20,
	0x74,
	0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73,
	0x74,
	0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20,
	0x74,
	0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73,
	0x20,
	0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73,
	0x20,
	0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74,
	0x68,
	0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74,
	0x2c,
	0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74,
	0x65,
	0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20,
	0x61,
	0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20,
	0x69,
	0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68,
	0x69,
	0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c,
	0x20,
	0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65,
	0x73,
	0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61,
	0x20,
	0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69,
	0x73,
	0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69,
	0x73,
	0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20,
	0x74,
	0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73,
	0x74,
	0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20,
	0x74,
	0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73,
	0x20,
	0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73,
	0x20,
	0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74,
	0x68,
	0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74,
	0x2c,
	0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74,
	0x65,
	0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20,
	0x61,
	0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20,
	0x69,
	0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68,
	0x69,
	0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c,
	0x20,
	0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65,
	0x73,
	0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61,
	0x20,
	0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69,
	0x73,
	0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69,
	0x73,
	0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20,
	0x74,
	0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73,
	0x74,
	0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20,
	0x74,
	0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73,
	0x20,
	0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73,
	0x20,
	0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74,
	0x68,
	0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74,
	0x2c,
	0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74,
	0x65,
	0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20,
	0x61,
	0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20,
	0x69,
	0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68,
	0x69,
	0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c,
	0x0a,
	0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65,
	0x73,
	0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61,
	0x20,
	0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69,
	0x73,
	0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69,
	0x73,
	0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a,
	0x74,
	0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73,
	0x74,
	0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20,
	0x74,
	0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73,
	0x20,
	0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73,
	0x20,
	0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74,
	0x68,
	0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74,
	0x2c,
	0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74,
	0x65,
	0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20,
	0x61,
	0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20,
	0x69,
	0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68,
	0x69,
	0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c,
	0x20,
	0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65,
	0x73,
	0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61,
	0x20,
	0x74, 0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69,
	0x73,
	0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x0a, 0x74, 0x68, 0x69,
	0x73,
	0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x2c, 0x20,
	0x74,
	0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73,
	0x74,
	0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20,
	0x74,
	0x65, 0x73, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73,
	0x20,			/* (1820) */
	0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x0a, 0x00, 0xc7, 0x71, 0x01, 0x08,
	0x44,
	0x2d, 0xb4, 0x81, 0xe8, 0x03, 0xe8, 0x03, 0x01, 0x00, 0x00, 0x00, 0x68,
	0x57,
	0x95, 0x04, 0x0a, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x74, 0x65, 0x73, 0x74,
	0x32,
	0x2e, 0x74, 0x78, 0x74, 0x00, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73,
	0x20,
	0x74, 0x65, 0x73, 0x74, 0x32, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20,
	0x69,
	0x73, 0x20, 0x74, 0x65, 0x73, 0x74, 0x32, 0x2c, 0x20, 0x74, 0x68, 0x69,
	0x73,
	0x20, 0x69, 0x73, 0x20, 0x74, 0x65, 0x73, 0x74, 0x32, 0x2c, 0x0a, 0x74,
	0x68,
	0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x74, 0x65, 0x73, 0x74, 0x32, 0x2c,
	0x20,
	0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x74, 0x65, 0x73, 0x74,
	0x32,
	0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x74, 0x65,
	0x73,
	0x74, 0x32, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20,
	0x74,
	0x65, 0x73, 0x74, 0x32, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69,
	0x73,
	0x20, 0x74, 0x65, 0x73, 0x74, 0x32, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73,
	0x20,
	0x69, 0x73, 0x20, 0x74, 0x65, 0x73, 0x74, 0x32, 0x2c, 0x0a, 0x74, 0x68,
	0x69,
	0x73, 0x20, 0x69, 0x73, 0x20, 0x74, 0x65, 0x73, 0x74, 0x32, 0x2c, 0x20,
	0x74,
	0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x74, 0x65, 0x73, 0x74, 0x32,
	0x2c,
	0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x74, 0x65, 0x73,
	0x74,
	0x32, 0x2c, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x74,
	0x65,
	0x73, 0x74, 0x32, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73,
	0x20,
	0x74, 0x65, 0x73, 0x74, 0x32, 0x2c, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20,
	0x69,
	0x73, 0x20, 0x74, 0x65, 0x73, 0x74, 0x32, 0x0a, 0xc7, 0x71, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x54, 0x52, 0x41, 0x49,
	0x4c,
	0x45, 0x52, 0x21, 0x21, 0x21, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

unsigned char cpio_file_gz[] = {
	0x1f, 0x8b, 0x08, 0x08, 0x05, 0xf9, 0x6b, 0x57, 0x00, 0x03, 0x74, 0x65,
	0x73,
	0x74, 0x2e, 0x63, 0x70, 0x69, 0x6f, 0x00, 0x3b, 0x5e, 0xc8, 0xc8, 0x61,
	0xaf,
	0xbb, 0xa5, 0xf1, 0x05, 0xf3, 0x0b, 0x66, 0x46, 0x06, 0x06, 0x86, 0xec,
	0xf0,
	0x8e, 0x1f, 0x9c, 0x40, 0xfa, 0x3f, 0x5b, 0x49, 0x6a, 0x71, 0x89, 0x5e,
	0x49,
	0x45, 0x09, 0x03, 0x43, 0x49, 0x46, 0x66, 0xb1, 0x02, 0x10, 0x25, 0x2a,
	0x80,
	0xc4, 0x74, 0x14, 0x48, 0xe4, 0x73, 0x8d, 0xea, 0x1f, 0xd5, 0x3f, 0xaa,
	0x7f,
	0x54, 0xff, 0xa8, 0xfe, 0x51, 0xfd, 0x43, 0x4f, 0x3f, 0x17, 0xc3, 0x71,
	0x60,
	0x1d, 0xe9, 0x82, 0x54, 0x47, 0x66, 0x84, 0x4f, 0x65, 0xe1, 0x02, 0xd2,
	0x0f,
	0x18, 0x40, 0xf2, 0x46, 0xe0, 0x4a, 0x12, 0xa6, 0x07, 0x2c, 0x82, 0x30,
	0x02,
	0x2b, 0x97, 0x6b, 0xe8, 0x29, 0xe6, 0x3a, 0x5e, 0xc8, 0x00, 0x07, 0x8c,
	0x50,
	0x9a, 0x1b, 0x4c, 0x86, 0x04, 0x39, 0x7a, 0xfa, 0xb8, 0x06, 0x29, 0x2a,
	0x2a,
	0x32, 0x8c, 0x82, 0x21, 0x07, 0x00, 0x66, 0x19, 0x98, 0x5d, 0x00, 0x0a,
	0x00,
	0x00
};

int test(CPIO_T * c)
{
	uint8_t buf[2048];

	int fd0 = CPIO_open(c, (uint8_t *) "test.txt");
	if (fd0 < 0) {
		DBG_logF("CPIO Test failed, error opening file1\n");
		return fd0;
	}

	int fd1 = CPIO_open(c, (uint8_t *) "test2.txt");
	if (fd1 < 0) {
		CPIO_close(c, fd0);
		DBG_logF("CPIO Test failed, error opening file2\n");
		return fd1;
	}
	/* test capping count at filesize */
	size_t count = CPIO_read(c, fd0, buf, 2048);
	if (count != sizeof(cpio_filedata0) - 1) {	/* -1 to remove the null terminator */
		CPIO_close(c, fd0);
		CPIO_close(c, fd1);
		DBG_logF("CPIO Test failed, error reading file0 %llu\n",
			 (long long unsigned int)count);
		return -1;
	}
	/* test copied data. */
	if (memcmp(buf, cpio_filedata0, sizeof(cpio_filedata1) - 1) != 0) {
		CPIO_close(c, fd0);
		CPIO_close(c, fd1);
		DBG_logF("CPIO Test failed, corrupt data from file0 lrg\n");
		return -1;
	}
	/* test copying small ammount of data */
	count = CPIO_read(c, fd1, buf, 8);
	if (count != 8) {
		CPIO_close(c, fd0);
		CPIO_close(c, fd1);
		DBG_logF("CPIO Test failed, error reading file1\n");
		return -1;
	}
	/* test copied data. */
	if (memcmp(buf, cpio_filedata1, 8) != 0) {
		CPIO_close(c, fd0);
		CPIO_close(c, fd1);
		DBG_logF("CPIO Test failed, corrupt data from file1\n");
		return -1;
	}

	size_t tell = CPIO_tell(c, fd1);
	if (tell != 8) {
		CPIO_close(c, fd0);
		CPIO_close(c, fd1);
		DBG_logF("CPIO Test failed, file1 invalid pointer\n");
		return -1;
	}

	tell = CPIO_lseek(c, fd1, 0, SEEK_SET);
	if (tell != 0) {
		CPIO_close(c, fd0);
		CPIO_close(c, fd1);
		DBG_logF("CPIO Test failed, file1 invalid pointer on reset\n");
		return -1;
	}

	CPIO_close(c, fd1);
	CPIO_close(c, fd0);

	struct CPIO_stat stat;
	CPIO_stat(c, (uint8_t *) "test.txt", &stat);
	if (stat.filesize != sizeof(cpio_filedata0) - 1) {
		DBG_logF("CPIO Test failed, file1 invalid filesize\n");
		return -1;
	}
	if (stat.namesize != 9) {
		DBG_logF("CPIO Test failed, file1 invalid namesize\n");
		return -1;
	}

	CPIO_stat(c, (uint8_t *) "test2.txt", &stat);
	if (stat.filesize != sizeof(cpio_filedata1) - 1) {
		DBG_logF("CPIO Test failed, file2 invalid filesize\n");
		return -1;
	}
	if (stat.namesize != 10) {
		DBG_logF("CPIO Test failed, file2 invalid namesize\n");
		return -1;
	}
	return 0;
}

/*
 ** FUNCTION:      main
 **
 ** DESCRIPTION:   C main program for thread 1
 **
 ** RETURNS:       int
 */

int main()
{
	DBG_logF("CPIO Test\n");

	KRN_reset(&sched, schedQueues, MAX_PRIORITY, 0, istack, STACKSIZE, NULL,
		  0);
	bgtask = KRN_startOS("Background Task");
	KRN_startTimerTask("Timer Task", timestack, TSTACKSIZE);

	MASSRAM_T m;
	CPIO_T c;
	MASS_initRam(&m, cpio_file, sizeof(cpio_file), 1);
	CPIO_init(&c, (MASS_T *) & m);
	if (test(&c) != 0) {
		return -1;
	}
#ifdef CONFIG_ZLIB
	DBG_logF("CPIO zlib tests\n");
	MASS_initRam(&m, cpio_file_gz, sizeof(cpio_file_gz), 1);
	CPIO_init(&c, (MASS_T *) & m);
	if (test(&c) != 0) {
		return -1;
	}
#endif

	DBG_logF("CPIO Test passed\n");
	return 0;
}
